{"version":3,"file":"component---src-pages-sorteio-tsx-a8ba3c4a656425db4e6e.js","mappings":"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","sources":["webpack://faq/./src/assets/christmas-advertise.jpg","webpack://faq/./src/assets/christmas-advertise-creamy.png","webpack://faq/./src/pages/sorteio.tsx"],"sourcesContent":["export default __webpack_public_path__ + \"static/christmas-advertise-42b84c11b32e27318ed1df933766a388.jpg\";","export default __webpack_public_path__ + \"static/christmas-advertise-creamy-b2dd05c6431ec6dae6f6f6f2d24150bb.png\";","import React, { FC, useState, useEffect } from \"react\"\nimport { Helmet } from \"react-helmet\"\nimport { analyticsTrack } from \"../utils\"\nimport {\n  Layout,\n  LoadingScreen,\n  Participant,\n  ParticipantForm,\n  Popup,\n} from \"../components\"\nimport christmasAdvertise from \"../assets/christmas-advertise.jpg\"\nimport christmasAdvertiseCreamy from \"../assets/christmas-advertise-creamy.png\"\n\ninterface State {\n  loading: boolean\n  participants?: any\n  group?: {\n    name: string\n    comments: string\n  }\n}\n\nconst Content = ({ participants, group, showFriendOnClick }) => {\n  const [secretFriend, setSecretFriend] = useState([])\n  const [\n    shuffledparticipantsWithoutSecretFriend,\n    setShuffledparticipantsWithoutSecretFriend,\n  ] = useState([])\n\n  useEffect(() => {\n    const shuffleArray = (array: never[]) => {\n      const arrayCopy = [...array]\n      for (let i = arrayCopy.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1))\n        const temp = arrayCopy[i]\n        arrayCopy[i] = arrayCopy[j]\n        arrayCopy[j] = temp\n      }\n      return arrayCopy\n    }\n\n    setShuffledparticipantsWithoutSecretFriend(\n      shuffleArray(\n        participants.others.filter(\n          (participant: { name: any }) =>\n            participant.name.trim() !== participants.current.friend.trim()\n        )\n      )\n    )\n\n    setSecretFriend(\n      participants.others.find(\n        (participant: { name: any }) =>\n          participant.name.trim() === participants.current.friend.trim()\n      )\n    )\n  }, [])\n\n  const goToAdvertisePage = (link, category, action, label) => {\n    analyticsTrack(category, action, label)\n    window.open(link, \"_blank\", 'rel=\"noreferrer\"')\n  }\n\n  return (\n    <div className=\"page-container pt-4\">\n      <section className=\"row\">\n        <button\n          onClick={() =>\n            goToAdvertisePage(\n              \"https://www.meliuz.com.br/premium-link/505?utm_source=papelzinho&utm_medium=partner&utm_campaign=campanha100&utm_content=papelzinho-natal-2022\",\n              \"banner-meliuz\",\n              \"clique\",\n              \"acao-natal-meliuz\"\n            )\n          }\n          className=\"col-xl mb-4 group__button\"\n        >\n          <img\n            className=\"group__banner\"\n            src={christmasAdvertise}\n            alt=\"Natal com Méliuz\"\n          ></img>\n        </button>\n        <button\n          onClick={() =>\n            goToAdvertisePage(\n              \"https://www.creamy.com.br/produtos?utm_source=papelzinho&utm_medium=banner_amigo\",\n              \"banner-creamy\",\n              \"clique\",\n              \"acao-natal-creamy\"\n            )\n          }\n          className=\"col-xl mb-4 group__button\"\n        >\n          <img\n            className=\"group__banner\"\n            src={christmasAdvertiseCreamy}\n            alt=\"Natal com Creamy\"\n          ></img>\n        </button>\n      </section>\n\n      <section className=\"mb-4\">\n        <h2 className=\"group__name font-weight-bolder\">{group.name}</h2>\n        <span className=\"group__participants\">\n          {participants.others.length + 1} participantes\n        </span>\n        <p className=\"group__description\">{group.comments}</p>\n\n        <section className=\"mb-4\">\n          <button className=\"show-friend-btn\" onClick={showFriendOnClick}>\n            Revelar meu amigo secreto\n          </button>\n        </section>\n      </section>\n\n      <section className=\"mb-5\">\n        <div className=\"group__friend row\">\n          <Participant participant={secretFriend} isSecretFriend={true} />\n          <ParticipantForm participant={participants.current} />\n        </div>\n        <p\n          className=\"font-weight-bolder\"\n          style={{ fontSize: \"1.8rem\", marginBottom: \"32px\" }}\n        >\n          Outros Participantes\n        </p>\n        <div className=\"row\">\n          {shuffledparticipantsWithoutSecretFriend.map((participant, index) => (\n            <Participant key={index} participant={participant} />\n          ))}\n        </div>\n      </section>\n    </div>\n  )\n}\n\nconst SorteioPage: FC = () => {\n  const initialState: State = {\n    loading: true,\n  }\n  const [state, setState] = useState(initialState)\n\n  const [showPopup, setShowPopup] = useState(false)\n\n  const showFriend: () => void = () => {\n    setShowPopup(true)\n  }\n\n  const hideFriend = () => {\n    analyticsTrack(\"cancel-button\", \"clique\", \"Campanha Méliuz\")\n    setShowPopup(false)\n  }\n\n  useEffect(() => {\n    const query = new URLSearchParams(window.location.search)\n    const groupId = query.get(\"g\")\n    const personId = query.get(\"p\")\n\n    fetch(`${process.env.GATSBY_API_HOST}/participant/${groupId}/${personId}`)\n      .then((response) => response.json())\n      .then((data) => {\n        if (data.message === \"Group not found\") {\n          alert(\n            \"Aparentemente o seu grupo de amigo secreto foi deletado pelo organizador no app. Caso esta mensagem esteja errada e seu grupo não tenha sido excluído, entre em contato com o suporte através do meajuda@papelzinho.com.br ou pelo chat na nossa página do facebook.\"\n          )\n          return\n        } else if (data.message === \"\") {\n          alert(\n            \"Participante não encontrado. Entre em contato com o suporte através do meajuda@papelzinho.com.br ou pelo chat na nossa página do facebook.\"\n          )\n          return\n        }\n\n        const participants = data.participants.reduce(\n          (acc: any, participant: { current: any }) => {\n            const newMap = acc\n            if (participant.current) {\n              newMap[\"current\"] = {\n                ...participant,\n                groupId,\n              }\n            } else if (newMap[\"others\"]) {\n              newMap[\"others\"].push(participant)\n            } else {\n              newMap[\"others\"] = [participant]\n            }\n            return newMap\n          },\n          {}\n        )\n\n        setState({\n          loading: false,\n          participants,\n          group: { name: data.name, comments: data.comments },\n        })\n        setShowPopup(true)\n      })\n      .catch(() => {\n        alert(\n          \"Sistema fora do ar. Estamos trabalhando para corrigir o problema o mais rápido possível. Tente acessar novamente mais tarde.\"\n        )\n      })\n  }, [false])\n\n  return (\n    <Layout>\n      <Helmet>\n        <title>Sorteio | Papelzinho ™</title>\n      </Helmet>\n\n      {state.loading ? (\n        <LoadingScreen />\n      ) : (\n        <Content\n          showFriendOnClick={showFriend}\n          group={state.group}\n          participants={state.participants}\n        />\n      )}\n\n      {showPopup && (\n        <Popup\n          message={`\"${state.participants.current.friend}\"`}\n          action2={hideFriend}\n        />\n      )}\n    </Layout>\n  )\n}\n\nexport default SorteioPage\n"],"names":["Content","participants","group","showFriendOnClick","useState","secretFriend","setSecretFriend","shuffledparticipantsWithoutSecretFriend","setShuffledparticipantsWithoutSecretFriend","useEffect","array","arrayCopy","i","length","j","Math","floor","random","temp","shuffleArray","others","filter","participant","name","trim","current","friend","find","goToAdvertisePage","link","category","action","label","analyticsTrack","window","open","className","onClick","src","christmasAdvertise","alt","christmasAdvertiseCreamy","comments","isSecretFriend","style","fontSize","marginBottom","map","index","key","loading","state","setState","showPopup","setShowPopup","query","URLSearchParams","location","search","groupId","get","personId","fetch","process","then","response","json","data","message","reduce","acc","newMap","push","alert","catch","Helmet","action2"],"sourceRoot":""}